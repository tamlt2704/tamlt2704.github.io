<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="./faker.js"> </script>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
</head>
<body>
    <div id='root'> </div>
    <script type='text/babel'>

        var faker_types = {
            'address': [
                'zipCode', 'city', 'cityPrefix', 'citySuffix'
            ],
            'name': [
                'firstName', 'lastName'
            ],
        }
        
        class DataField extends React.Component { 
            handleDataFieldInputChange = (evt) => {
                /*
                console.log(evt.target.name);
                console.log(evt.target.value);
                console.log(this.props.id);
                */

                this.props.onDataFieldChanged(this.props.id, evt);
            }

            render() {
                const typeOptions = faker_types[this.props.category].map((opt, i) => (
                    <option value={opt} key={i}> {opt} </option>
                ));

                const categoryOptions = Object.keys(faker_types).map((opt, i) => (
                    <option value={opt} key={i}> {opt} </option>
                ));


                return (
                    <div>
                        <span 
                            //style={{'margin-left': '20px'}}
                            id={this.props.id}
                            onClick={this.props.onDataFieldDeleteClicked}> x </span>

                        <input value={this.props.name} name='name'
                            onChange={this.handleDataFieldInputChange}/>

                        <select value={this.props.category}
                            name='category'
                            onChange={this.handleDataFieldInputChange}
                        >
                            {categoryOptions}
                        </select>

                        <select value={this.props.type}
                            name='type'
                            onChange={this.handleDataFieldInputChange}
                        >
                            {typeOptions}
                        </select>
                        {this.props.sample_text}
                        
                    </div>
                )
            }
        }

        class App extends React.Component {
            state = {
                dataFields: [],
            }
           
            onDataFieldChanged  = (id, evt) => {
                const dataFields = this.state.dataFields.map(d => {
                    if (d.id === id) {
                        if (evt.target.name === 'category') {
                            var obj = Object.assign({...d}, {
                                'category': evt.target.value,
                                'type': faker_types[evt.target.value][0],
                            });
                            obj['sample_text'] = faker[obj.category][obj.type]();
                            return obj;
                        } else if (evt.target.name === 'type') {
                            var obj = Object.assign({...d}, {
                                'type': evt.target.value
                            });
                            obj['sample_text'] = faker[obj.category][obj.type]();
                            return obj;
                        } else {
                            return Object.assign({...d}, {
                                [evt.target.name]: evt.target.value
                            });
                        }
                    } else {
                        return d;
                    }
                });

                this.setState({
                    dataFields: dataFields
                });
            }
            
            onDataFieldDeleteClicked = (evt) => {
                const deletedId = evt.target.id; 
                this.setState({
                    dataFields: this.state.dataFields.filter(d => d.id != deletedId)
                });
            }

            createDataFieldModel = () => ({
                'id': this.state.dataFields.length,
                'key': this.state.dataFields.length,
                'name': `id_${this.state.dataFields.length}`,
                'category': 'name',
                'type': 'firstName',
                'sample_text': faker['name']['firstName'](),
                onDataFieldChanged: this.onDataFieldChanged,
                onDataFieldDeleteClicked: this.onDataFieldDeleteClicked

            })

            componentDidMount() {
                this.setState({
                    dataFields: this.state.dataFields.concat(this.createDataFieldModel())
                })
            }
            
            addNewFieldHandle = () => {
                this.setState({
                    dataFields: this.state.dataFields.concat(this.createDataFieldModel())
                })
            }

            render() {
                const dataFieldElements = this.state.dataFields.map(d => (
                        <DataField {...d} />
                    ));

                return(
                    <div>
                        Generate dummy data for test
                        {dataFieldElements}

                        <button onClick={this.addNewFieldHandle}> Add </button>
                    </div>
                );
            }
        }

        ReactDOM.render(
            <App />,
            document.getElementById('root')
        );
    </script>
</body>
</html>


