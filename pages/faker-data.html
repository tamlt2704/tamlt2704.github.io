<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="./faker.js"> </script>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
</head>
<body>
    <div id='root'> </div>
    <script type='text/babel'>

        var faker_types = {
            'address': [
                'zipCode', 'city', 'cityPrefix', 'citySuffix'
            ],
            'name': [
                'firstName', 'lastName'
            ],
        }

        class DataField extends React.Component {
            handleTypeChange = (event) => {
                const selectedType = event.target.value;
                if (event.target.id === 'field_type_opt') {
                    const obj = {...this.props, ...{
                        'field_type':  selectedType,
                        'sub_type': faker_types[selectedType][0],
                        sampleText: faker[selectedType][faker_types[selectedType][0]]()
                    }};
                    this.props.onDataFieldChange(obj);
                } else if (event.target.id === 'sub_type_opt') {
                    const obj = {...this.props, ...{
                        'sub_type':  selectedType,
                         sampleText: faker[this.props.field_type][selectedType]()
                    }};
                    this.props.onDataFieldChange(obj);
                } else if (event.target.id === 'field_name_input') {
                    const obj = {...this.props, ...{
                        'field_name':  event.target.value
                        }};
                    this.props.onDataFieldChange(obj);
                }
            }
            
            render() {
                return (
                    <div>
                       <input id={'field_name_input'}
                            value={this.props.field_name}
                            onChange={this.handleTypeChange}
                            />
                       <select 
                         id={'field_type_opt'}
                         onChange={this.handleTypeChange}
                        >
                           {
                            Object.keys(faker_types).map(t => (
                                <option 
                                    value={t} 
                                    key={t}
                                >{t}</option>
                            ))
                           } 
                       </select>

                       <select 
                            id={'sub_type_opt'}
                            onChange={this.handleTypeChange}
                            >
                            {faker_types[this.props.field_type].map(t=> (
                                <option 
                                    value={t} 
                                    key={t}
                                >{t}</option>
                            ))}
                        </select>
                        Example: {this.props.sampleText}
                    </div>
                );
            }
        }

        class App extends React.Component {
            state = {
                dataFields: [
                {
                    id:0,
                    key:0,
                    locale: 'en',
                    field_name: 'id',
                    field_type: 'name',
                    sub_type: 'firstName',
                    sampleText: faker['name']['firstName'](),
                }
                ],
            }
            
            handleDataFieldChange = (obj) => {
                const newState = this.state.dataFields.map(x => {
                    return x.id === obj.id ? obj : x;
                });
                this.setState({dataFields: newState});
            }

            addFieldName = () => {
                const id = this.state.dataFields.length;
                const sample = {
                    id: this.state.dataFields.length,
                    key: this.state.dataFields.length,
                    locale: 'en',
                    field_name: `id_${id}`,
                    field_type: 'name',
                    sub_type: 'firstName',
                    sampleText: faker['name']['firstName']()
                };

                this.setState({
                    dataFields: this.state.dataFields.concat(sample)
                });
            }

            render() {
                const dataFields = this.state.dataFields.map(d => ( < DataField {...d}
                onDataFieldChange = {this.handleDataFieldChange} />)); 
                    
                return (
                    <div> 
                        {dataFields}
                        <div 
                        onClick={this.addFieldName}
                        className='btn'> Add New Field </div>
                    </div>
                );
            }
        }
        ReactDOM.render(
            <App />,
            document.getElementById('root')
        );
    </script>
</body>
</html>


